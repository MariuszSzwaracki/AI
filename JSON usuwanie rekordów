import os
import json

# Nazwa folderu gÅ‚Ã³wnego do przeszukania
TARGET_FOLDER = 'figo'
# Klucz do usuniÄ™cia
KEY_TO_REMOVE = 'url'

def remove_key_recursive(data, key):
    """
    Rekurencyjnie usuwa klucz ze sÅ‚ownikÃ³w i list zagnieÅ¼dÅ¼onych.
    DziaÅ‚a w miejscu (modyfikuje przekazany obiekt).
    """
    if isinstance(data, dict):
        # JeÅ›li znaleziono klucz w sÅ‚owniku, usuÅ„ go
        if key in data:
            del data[key]
        # Przeszukaj pozostaÅ‚e wartoÅ›ci
        for k, v in data.items():
            remove_key_recursive(v, key)
            
    elif isinstance(data, list):
        # JeÅ›li to lista, przeszukaj kaÅ¼dy element
        for item in data:
            remove_key_recursive(item, key)

def process_files():
    if not os.path.exists(TARGET_FOLDER):
        print(f"âŒ BÅ‚Ä…d: Nie znaleziono folderu '{TARGET_FOLDER}' w bieÅ¼Ä…cym katalogu.")
        return

    print(f"ðŸš€ Rozpoczynam czyszczenie plikÃ³w w folderze '{TARGET_FOLDER}'...")
    processed_count = 0
    error_count = 0

    # Przechodzimy przez wszystkie katalogi i podkatalogi (os.walk)
    for root, dirs, files in os.walk(TARGET_FOLDER):
        for file in files:
            # InteresujÄ… nas tylko pliki .json
            if file.lower().endswith('.json'):
                file_path = os.path.join(root, file)
                
                try:
                    # 1. Wczytaj plik
                    with open(file_path, 'r', encoding='utf-8') as f:
                        data = json.load(f)

                    # 2. UsuÅ„ klucz (rekurencyjnie, jeÅ›li jest zagnieÅ¼dÅ¼ony)
                    remove_key_recursive(data, KEY_TO_REMOVE)

                    # 3. Zapisz plik z powrotem (formatujÄ…c go Å‚adnie)
                    with open(file_path, 'w', encoding='utf-8') as f:
                        json.dump(data, f, indent=4, ensure_ascii=False)
                    
                    print(f"âœ… Wyczyszczono: {file_path}")
                    processed_count += 1

                except json.JSONDecodeError:
                    print(f"âš ï¸ PominiÄ™to (bÅ‚Ä…d skÅ‚adni JSON): {file_path}")
                    error_count += 1
                except Exception as e:
                    print(f"âŒ BÅ‚Ä…d pliku {file_path}: {e}")
                    error_count += 1

    print("\n" + "="*40)
    print(f"ðŸ ZakoÅ„czono.")
    print(f"Przetworzono plikÃ³w: {processed_count}")
    if error_count > 0:
        print(f"BÅ‚Ä™dÃ³w: {error_count}")

if __name__ == "__main__":
    process_files()
